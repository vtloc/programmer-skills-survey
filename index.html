<!DOCTYPE html>
<html>
  <head>
    <title>Grokking</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <style media="screen">
      .area-group {
        margin-top: 20px;
      }

      .area {
        border: 1px solid white;
        background-color: #6aaff9;
        font-weight: bold;
        text-align: center;
      }

      .area .title {
        margin-top: 10px;
        margin-bottom: 10px;
        color: white;
      }

      .topic {
        border: 1px solid;
        border-radius: 5px;
        background-color: yellow;
        margin: 2px;
        max-width: calc(100% / 3 - 4px);
        min-height: 50px;

        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;

        font-size: 10px;
        color: black;

        cursor: pointer;
      }

      .topic.chosen {
        background-color: #2257ce;
        color: white;
      }

      .body-wrapper {
        margin: 5px;
      }

      /*modal*/
      #choose-topic-modal .modal-body .statistic-show-container {
        border-right: 1px solid grey;
      }

      #choose-topic-modal .modal-body .statistic-choice {
        margin-top: 64px;
      }

      #choose-topic-modal .link-footer {
        margin-top: 15px;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h3>Software Engineer Knowledge Area</h3>
      <p>
        Dựa theo kinh nghiệm cá nhân, một bạn CTO tổng hợp những mảng kiến thức cần thiết dựa trên kinh nghiệm của mình.
        Các bạn thử đánh dấu xem mình nắm được bao nhiêu trong những mảng kiến thức này?

        Đọc bài viết gốc ở đây: <a href="#">Link</a>
      </p>
    </div>

    <div class="container vote-container">
      <div class="row area-group">
        <div class="col-sm-4 area" id="area-1"></div>
        <div class="col-sm-4 area" id="area-2"> </div>
        <div class="col-sm-4 area" id="area-3"> </div>
      </div>

      <div class="row area-group">
        <div class="col-sm-12 area" id="area-4"> </div>
      </div>

      <div class="row area-group">
        <div class="col-sm-6 area" id="area-5"> </div>
        <div class="col-sm-6 area" id="area-6"> </div>
      </div>
    </div>


    <!-- Modal -->
    <div class="modal fade" id="choose-topic-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="container">
              <div class="row">
                <div class="col-sm-6 statistic-show-container">
                  <p>
                    Kết quả đánh giá từ cộng đồng
                  </p>
                  <ul class="statistic-show-data">
                    <li>Chưa biết về kỹ năng này: <span skill-level=0>1</span> </li>
                    <li>Đã biết về nó, nhưng chưa dùng bao giờ: <span skill-level=1>1</span> </li>
                    <li>Đã làm qua, nhưng chưa thành thạo: <span skill-level=2>1</span> </li>
                    <li>I grokked this: <span skill-level=3>1</span> </li>
                  </ul>
                </div>
                <div class="col-sm-6 statistic-choice">
                  <div class="form-check">
                    <label class="form-check-label">
                      <input class="form-check-input" type="radio" name="statistic-choice" id="statistic-choice-0" value="level 0" checked>
                      Chưa biết về kỹ năng này
                    </label>
                  </div>
                  <div class="form-check">
                    <label class="form-check-label">
                      <input class="form-check-input" type="radio" name="statistic-choice" id="statistic-choice-1" value="level 1">
                      Đã biết về nó, nhưng chưa dùng bao giờ
                    </label>
                  </div>
                  <div class="form-check">
                    <label class="form-check-label">
                      <input class="form-check-input" type="radio" name="statistic-choice" id="statistic-choice-2" value="level 2">
                      Đã làm qua, nhưng chưa thành thạo
                    </label>
                  </div>
                  <div class="form-check">
                    <label class="form-check-label">
                      <input class="form-check-input" type="radio" name="statistic-choice" id="statistic-choice-3" value="level 3">
                      I grokked this
                    </label>
                  </div>
                </div>
              </div>

              <div class="row link-footer">
                <div class="col-xl-12">
                  Để nâng cao kiến thức về mảng này, bạn có thể tham gia tại đây: <a href="#">Link</a>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <script type="text/javascript">
      var $modal = $("#choose-topic-modal");

      // Render area
      var renderArea = function(areaId, data, dataIndex) {
        topicData = data["topics"]
        var area = d3.select(".vote-container")
                                      .select(".area#" + areaId)
                                      .append("div").attr("class", "title").text(data["name"])
                                      .append("div").attr("class", "body-wrapper row")
                                      .selectAll(".topic")
                                      .data(topicData);

            area.enter().append("div")
                        .attr("class", "topic col-sm-4")
                        .attr("topic-index", function(d, i) {   // use this index to pour data to statistic modal
                          return dataIndex + '-' + i;
                        })
                        .text(function(d) { return d.name; });
      }

      // render Topic
      var renderTopic = function() {
        // Click on topics
        $(".topic").on('click', function() {
          // open statistic modal
          $modal.modal("show", this);

          // highlight
          $(this).addClass('chosen');
        });
      }

      // Fetch areas from api
      var xhr = $.get('http://private-a54a7-semap.apiary-mock.com/map', function(d, status, xhr) {
        // Render areas
        window.data = d["areas"];
        $.each(window.data, function(index, areaData) {
          renderArea(areaData["id"], areaData, index);
        });

        renderTopic();
      })
      .fail(function(a, b, c) {
        alert("error");
      })




      // Display modal
      var renderModal = function(areaData, topicData) {
        // render title
        $modal.find(".modal-title").html(areaData["name"] + " > " + topicData["name"])

        // render statistic data
        statisticData = topicData["statistic"];
        statisticDataSection = $modal.find(".statistic-show-container .statistic-show-data")
        statisticDataSection.find("span[skill-level=0]").html(statisticData['level_0']);
        statisticDataSection.find("span[skill-level=1]").html(statisticData['level_1']);
        statisticDataSection.find("span[skill-level=2]").html(statisticData['level_2']);
        statisticDataSection.find("span[skill-level=3]").html(statisticData['level_3']);

        // render statistic choice
      };

      $modal.on('show.bs.modal', function(e) {
        var [areaIndex, topicIndex] = $(e.relatedTarget).attr("topic-index").split('-');
        areaData = window.data[areaIndex];
        topicData = data[areaIndex]["topics"][topicIndex];
        renderModal(areaData, topicData);
      });

      // $(".topic[topic-index=0-0]").trigger("click");
    </script>

  </body>
</html>
